<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
	<head>
        <title>Records with similar name</title>
        <style type="text/css">
            body {
                font-family: Segoe UI, Tahoma, Arial;
                background-color: #ffffff;
                font-size: 14px;
                position: initial;
            }

        td,tr {
            font-family: Segoe UI, Tahoma, Arial;
            font-style:normal;
        }
        thead, tfoot, th{  
            border: 1px ridge #808080;
            border-right-color:#ffffff;
            border-left-color:#ffffff;
            border-collapse :collapse;
            font-weight:normal;      
        }
          tfoot{
            background-color: rgba(221, 221, 221, 0.5);
        }

        table {
            border-collapse:collapse;
            position: absolute;
            top: 0;
            bottom: 0;
            left: 0;
            right: 0;
            height: 100%;
            width: 100%;
            font-size: 12px;
        }

        </style>
        <script src="ClientGlobalContext.js.aspx" type="text/javascript"></script>
        <script src="ccrm_sdk_rest_data_library" type="text/javascript"></script>
        <script type="text/javascript">

        document.onreadystatechange = function () {
            if (document.readyState == "complete") {
                getMoreResults();
            }
        }

        function getMoreResults() {
            
            var strURL = getClientUrl();
            var resJsonMsg = parent.Xrm.Page.getAttribute("arup_dupecheckresult").getValue();
            var list = JSON.parse(resJsonMsg);
          
            //Create a table and header using the DOM
            var oTable = document.createElement("table");
            var oTHead = document.createElement("thead");
            var oTHeadTR = document.createElement("tr");
            var oTHeadTRTH1 = document.createElement("th");
            oTHeadTRTH1.align = "left";
            setText(oTHeadTRTH1, "Similar record");
            var oTHeadTRTH2 = document.createElement("th");
            oTHeadTRTH2.align = "left";
            setText(oTHeadTRTH2, "City");
            var oTHeadTRTH3 = document.createElement("th");
            oTHeadTRTH3.align = "left";
            setText(oTHeadTRTH3, "Rank");
            oTHeadTR.appendChild(oTHeadTRTH1);
            oTHeadTR.appendChild(oTHeadTRTH2);
            oTHeadTR.appendChild(oTHeadTRTH3);
            oTHead.appendChild(oTHeadTR);
            oTable.appendChild(oTHead);
            var oTBody = document.createElement("tbody");

           // var len = list.length < 5 ? list.length : 5;

            for (var i = 5; i < list.length ; ++i) {
                var acc = list[i];
                var oTRow = document.createElement("tr");

                var oTRowTD1 = document.createElement("td");
                oTRowTD1.innerHTML = '<a href="' + strURL + "main.aspx?etn=account&pagetype=entityrecord&id=%7B" + acc.Id + "%7D" + '" target="_blank">' + acc.Name + '</a>';

                var oTRowTD2 = document.createElement("td");
                setText(oTRowTD2, acc.City);

                var oTRowTD3 = document.createElement("td");
                oTRowTD3.align = "center";
                setText(oTRowTD3, acc.Rank);

                oTRow.appendChild(oTRowTD1);
                oTRow.appendChild(oTRowTD2);
                oTRow.appendChild(oTRowTD3);
                oTBody.appendChild(oTRow);
            }
          

            var oTFoot = document.createElement("tfoot");
            var oTFootTR = document.createElement("tr");
            
         
            var oTFootTRTD1 = document.createElement("td");
            oTFootTRTD1.colSpan = "3";
            var oTFootTRTD1Para = document.createElement("p");
            oTFootTRTD1Para.align = "right";
            oTFootTRTD1Para.style.color = "blue";
            oTFootTRTD1Para.style.cursor = "pointer";

            setText(oTFootTRTD1Para, "Go Back to previous page");
            oTFootTRTD1.appendChild(oTFootTRTD1Para);

            oTFootTRTD1.onclick = function () {
                        var wrControl = parent.Xrm.Page.ui.controls.get("WebResource_DuplicateCheckResult");
                        var srcUrl = wrControl.getSrc();
                        var changeSrcURl = srcUrl;                  
                        wrControl.setSrc(changeSrcURl);     
            };
            oTFootTR.appendChild(oTFootTRTD1);
            

            oTFoot.appendChild(oTFootTR);
            
            oTable.appendChild(oTBody);
            oTable.appendChild(oTFoot);
            document.body.appendChild(oTable);            
        }
  
        function getDataParam() {
            //Get the any query string parameters and load them
            //into the vals array

            var vals = new Array();
            if (location.search != "") {
                vals = location.search.substr(1).split("&");
                for (var i in vals) {
                    vals[i] = vals[i].replace(/\+/g, " ").split("=");
                }
                //look for the parameter named 'data'
                var found = false;
                var accId = "";
                for (var i in vals) {
                    if (vals[i][0].toLowerCase() == "data") {
                        accId = vals[i][1];
                        found = true;
                        break;
                    }
                }
                if (!found)
                { return "null"; }
                else { return accId; }
            }
            else {
                return "null";
            }
        }
  
        //Added for cross browser support.
        function setText(element, text) {
            if (typeof element.innerText != "undefined") {
                element.innerText = text;
            }
            else {
                element.textContent = text;
            }
        }
 
        function getClientUrl() {
            var strUrl = parent.Xrm.Page.context.getClientUrl();
            if (strUrl.substr(strUrl.length - 1) != "/") {
                strUrl += "/";
            }
            return strUrl;
        }   

        </script>

	</head>
	<body>
	
	</body>
</html>