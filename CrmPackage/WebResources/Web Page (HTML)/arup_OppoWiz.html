<html>
<head>
    <title>Opportunity Wizard</title>
</head>
<body style="overflow-wrap: break-word;">
    ﻿

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1">


    <link rel="stylesheet" href="arup_BootStrapCSS">
    <link rel="stylesheet" href="arup_BootStrap_ThemeCSS">
    <link rel="stylesheet" href="arup_Bootstrap_TableCSS">
    <link rel="stylesheet" href="arup_Bootstrap_MultiselectCSS">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@tarekraafat/autocomplete.js@7.2.0/dist/css/autoComplete.min.css">
    <link rel="stylesheet" href="arup_OppoWiz.css">
    <script type="text/javascript" src="ccrm_/JavaScripts/Lib/jquery_3.2.0.min"></script>
    <script type="text/javascript" src="arup_BootStrap.min"></script>
    <script type="text/javascript" src="arup_Bootstrap_TableJS"></script>
    <script type="text/javascript" src="arup_Bootstrap_MultiselectJS"></script>
    <script type="text/javascript" src="arup_OppoWiz.js"></script>
    <script type="text/javascript" src="arup_OppoWizValidate.js"></script>
    <script type="text/javascript" src="mag_/js/alert.js"></script>
    <script src="ClientGlobalContext.js.aspx" type="text/javascript"></script>
    <script src="arup_SDK.WebAPI_min.js" type="text/javascript"></script>
    <!--<script type="text/javascript" src="//cdn.jsdelivr.net/npm/@tarekraafat/ autocomplete.js@7.2.0/dist/js/autoComplete.min.js"></script>-->
    <!--<script type="text/javascript" src="arup_lib/autoComplete.js"></script>-->

    <script src="arup_OppoWizAutocomplete.js" type="text/javascript"></script>
    <script type="text/javascript">
        $(document).ready(function () {
            //Initialize tooltips
            $(".win-close").click(function (e) {

                window.close();

            });

            $("#mysub").wizard({
                exitText: 'exit',
                onfinish: function (e) {
                    var form = document.querySelector("form#page4");
                    Arup.validateOppWiz.validate(form).then(
                        function () {
                            saveOpportunity().then(
                                function (result) {
                                    Xrm.Utility.closeProgressIndicator();
                                    Xrm.Navigation.openAlertDialog({
                                        text: "Opportunity " + result.name + " has been created",
                                        title: "Opportunity " + result.newEntityid + " Created"
                                    });
                                },
                                function (errorDetail) {
                                    Xrm.Utility.closeProgressIndicator();
                                    Xrm.Navigation.openErrorDialog(errorDetail);
                                });
                            Xrm.Utility.showProgressIndicator("Creating Opportunity");
                        },
                        function (errors) {
                            Xrm.Navigation.openErrorDialog({
                                message: "Invalid input - correct the form and try again",
                                // details: (typeof(errors) === "object") ? errors.join("\r\n") : errors,
                                title : "Validation errors"
                            });
                        }
                    );
                }
            }
            );

            // Hook up on the fly validation of input fields.
            //var form = document.querySelector("form#page4");
            //Arup.validateOppWiz.addValidationHooks(form);

            //  var validator = new ArupValidateOppoWiz(document, "form#page4");

            //   var projectName = new ArupAutoCompleteField( "WC", "project_name", "Project Name 2",  "ccrm_name", validator,  {  presence: { message: "- a name is required" }  });

            $('.multiselect-item .caret-container').click();

            // setupAutocomplete();
        });

    </script>
    <style type="text/css">
    </style>



    <div class="container">
        <br><h1 class="mainPage"><b>New Opportunity Wizard</b></h1>
        <h4 class="mainPage1">Select opportunity category</h4>
    </div>
    <br>
    <div class="container" width="100%" height="100%" id="mysub">
        <div class="wizard-content">
            <div class="wizard-steps-panel steps-quantity-4" onkeyup="nextOnReturn(this)">
                <div class="step-number step-1 doing">
                    <div class="number"><div class="img-circle"><img src="arup_userrolejpg"></div></div>
                </div>
                <div class="step-number step-2">
                    <div class="number">2</div>
                </div>
                <div class="step-number step-3">
                    <div class="number">3</div>
                </div>
                <div class="step-number step-4">
                    <div class="number">4</div>
                </div>
            </div>
            <!--<br /> -->
            <div class="container"> <br><br></div>
            <div class="wizard-step" style="display: block;" id="UR_Step">

                <div class="container" id="UR">
                    <h2>Arup Internal </h2>
                    <p><b><ins>Select whether the new opportunity is either Internal or External</ins></b></p>
                    <form id="URForm">
                        <div class="radio">
                            <label><input type="radio" name="stepone" value="INT" autofocus="true">&nbsp;Internal</label>
                        </div>
                        <div class="radio">
                            <label><input type="radio" name="stepone" value="NOTINT">&nbsp;External</label>
                        </div>
                    </form>
                </div>
                <br><br>
            </div>
            <div class="wizard-step" style="display: none;" id="SS_Step">
                <!--<div id="exButtons">
                    <button type="button" id="exBack" class="btn btn-default wizard-button-back  pull-left">Back</button>
                    <button type="button" id="exNext" class="btn btn-default wizard-button-next pull-right">Next</button>
                </div>
                <br /><br />-->
                <div class="container" id="SS">
                    <form class="" id="main">
                        <div class="form-group">
                            <label for="opportunityType">Opportunity Type:</label>
                            <select id="opportunityType" class="form-control" onchange="onOpportunityTypeChange(this.value)" title="Select Opportunity Type" autofocus>
                                <option value="">Select Opportunity Type</option>
                                <option value="770000000" title="New Opportunity">New Opportunity</option>
                                <option value="770000001" title="Project extension - existing contract">Project extension - existing contract</option>
                                <option value="770000002" title="Project extension – new contract">Project extension – new contract</option>
                                <option value="770000003" title="New Framework/Panel/Call-Off">New Framework/Panel/Call-Off</option>
                                <option value="770000004" title="Project under existing Framework/Panel/Call-Off">Project under existing Framework/Panel/Call-Off</option>
                                <option value="770000005" title="Architectural competition with multiple Arup teams – master record">Architectural competition with multiple Arup teams – master record</option>
                                <option value="770000006" title="Architectural competition with multiple Arup teams – team opportunity">Architectural competition with multiple Arup teams – team opportunity</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="relatedopportunity">Related Parent Opportunity:</label>
                            <input list="opportunities" id="relatedopportunity" class="form-control" name="relatedopportunity" oninput="getOpportunities(this.value);" title="Input related parent opportunity" autocomplete="off" onfocusout="ensureSelected(this)" />
                            <datalist id="opportunities">
                            </datalist>
                        </div>
                        <div class="form-group">
                            <label for="leadSource">Lead Source:</label>
                            <!----<span class="glyphicon glyphicon-lock"></span>-->
                            <select id="leadSource" class="form-control" title="Enter Source of Opportunity">
                                <option value="">Select Lead Source</option>
                                <option value="100000000" title="Arup bid to supply same/further services, as an extension to an existing project. (One Arup team delivering to the client).">Addition to existing services</option>
                                <option value="100000002" title="Arup has identified an opportunity, suggested the project idea, then submitted a bid to a client.">Arup project (idea) creation</option>
                                <option value="5" title="Arup invited to bid, as one of a shortlist previously chosen via a panel, framework agreement or other process.">Framework/Panel</option>
                                <option value="6" title="Arup team cross-sell separate expertise, and introduce an additional Arup team.  (More than one Arup team delivering to the client).">Internal Referral and cross-selling</option>
                                <option value="3" title="Arup is the only firm invited to bid, without competition.">Invitation - Arup Only</option>
                                <option value="8" title="Arup invited to bid, as one of a limited number of competitors.">Invitation to Compete</option>
                                <option value="11" title="Arup bid follows long-term activities to build a relationship with the client, and demonstrate our capabilities, aiming to become the ‘first choice for project’.">Long-Term Opportunity</option>
                                <option value="10" title="Arup chose to bid following a public open invitation.">Public Advertisement/OJEU</option>
                            </select>
                            <select id="leadSource1" class="form-control" title="Enter Source of Opportunity">
                                <option value="">Select Lead Source</option>
                                <option value="100000000" title="Arup bid to supply same/further services, as an extension to an existing project. (One Arup team delivering to the client).">Addition to existing services</option>
                                <option value="100000002" title="Arup has identified an opportunity, suggested the project idea, then submitted a bid to a client.">Arup project (idea) creation</option>
                                <option value="5" title="Arup invited to bid, as one of a shortlist previously chosen via a panel, framework agreement or other process.">Framework/Panel</option>
                                <option value="6" title="Arup team cross-sell separate expertise, and introduce an additional Arup team.  (More than one Arup team delivering to the client).">Internal Referral and cross-selling</option>
                                <option value="3" title="Arup is the only firm invited to bid, without competition.">Invitation - Arup Only</option>
                                <option value="8" title="Arup invited to bid, as one of a limited number of competitors.">Invitation to Compete</option>
                                <option value="11" title="Arup bid follows long-term activities to build a relationship with the client, and demonstrate our capabilities, aiming to become the ‘first choice for project’.">Long-Term Opportunity</option>
                                <option value="10" title="Arup chose to bid following a public open invitation.">Public Advertisement/OJEU</option>
                            </select>
                        </div>
                        <br />
                        <br />
                        <div class="form-group">
                            <div class="suppt col-lg-6"><textarea class="form-control" id="ta1" rows="5" tabindex="-1"></textarea></div>
                            <div class="suppt col-lg-6"><textarea class="form-control" id="ta2" rows="5" tabindex="-1"></textarea></div>
                        </div>
                    </form>
                </div>
                <br><br>
            </div>
            <div class="wizard-step" style="display: none;" id="CN_Step">
                <div class="container" id="CN">

                    <label for="contractarrangement">Project Procurement:</label>
                    <select id="contractarrangement" class="form-control" title="Regardless of Arup’s role, this PROJECT is being procured / delivered as a [choose “project procurement”]" attrname="ccrm_contractarrangement">
                        <option value="--">--</option>
                        <option title="Alliance" value="100000000">Alliance</option>
                        <option title="Design &amp; Construct/Design-Build/ECI" value="1">Design &amp; Construct/Design-Build/ECI</option>
                        <option title="Design-Build-Operate" value="100000002">Design-Build-Operate</option>
                        <option title="Management Contracting/Construction Management" value="3">Management Contracting/Construction Management</option>
                        <option title="Public Private Partnership" value="4">Public Private Partnership</option>
                        <option title="Traditional or Direct Appointment to Client" value="5">Traditional or Direct Appointment to Client</option>
                        <option title="Traditional or Direct Appointment to Client with Potential Future Novation" value="8">Traditional or Direct Appointment to Client with Potential Future Novation</option>
                        <option title="Turnkey" value="6">Turnkey</option>
                    </select>
                    <select id="contractarrangement1" class="form-control" title="Regardless of Arup’s role, this PROJECT is being procured / delivered as a [choose “project procurement”]" attrname="ccrm_contractarrangement">
                        <option value="--">--</option>
                        <option title="Alliance" value="100000000">Alliance</option>
                        <option title="Design &amp; Construct/Design-Build/ECI" value="1">Design &amp; Construct/Design-Build/ECI</option>
                        <option title="Design-Build-Operate" value="100000002">Design-Build-Operate</option>
                        <option title="Management Contracting/Construction Management" value="3">Management Contracting/Construction Management</option>
                        <option title="Public Private Partnership" value="4">Public Private Partnership</option>
                        <option title="Traditional or Direct Appointment to Client" value="5">Traditional or Direct Appointment to Client</option>
                        <option title="Traditional or Direct Appointment to Client with Potential Future Novation" value="8">Traditional or Direct Appointment to Client with Potential Future Novation</option>
                        <option title="Turnkey" value="6">Turnkey</option>
                    </select>
                </div>
                <br><br>
            </div>
            <form id="page4">
                <div class="wizard-step" style="display: none;" id="WC_Step">
                    <div class="container" id="WC">
                        <div class="form-group col-lg-6">
                            <label for="project_name">Project Name:</label>
                            <input id="project_name" class="form-control input-form" name="project_name" type="text" maxlength="200" attrname="name" autocomplete="off">
                        </div>
                        <div class="form-group col-lg-6">
                            <label for="project_country">Project Country:</label>
                            <input list="countries" id="project_country" class="form-control input-form" name="project_country" oninput="getCountries(this.value);" onfocusout="ensureSelected(this)" onchange="getStates();" title="Input project country" autocomplete="off" />
                            <datalist id="countries">
                            </datalist>
                        </div>
                        <div class="form-group col-lg-6">
                            <label for="project_state">Project State/Province:</label>
                            <input list="states" id="project_state" class="form-control input-form" name="project_state" title="Input project state" autocomplete="off" onfocusout="ensureSelected(this)"  readonly="true"/>
                            <datalist id="states">
                            </datalist>
                        </div>
                        <div class="form-group col-lg-6">
                            <label for="project_city">Project Town/City:</label>
                            <input list="cities" id="project_city" class="form-control input-form" name="project_city" title="Input project city" autocomplete="off" />
                            <datalist id="cities">
                            </datalist>
                        </div>
                        <div class="form-group col-lg-6">
                            <label for="arup_business">Arup Business:</label>
                            <input list="businesses" id="arup_business" class="form-control input-form" name="arup_business" oninput="getBusinesses();" onchange="getSubBusinesses()" onfocusout="ensureSelected(this)"  title="Input arup business" autocomplete="off" placeholder="Business Area" />
                            <datalist id="businesses">
                            </datalist>
                        </div>
                        <div class="form-group col-lg-6">
                            <label for="arup_subbusiness">Arup Sub Business:</label>
                            <input list="subbusinesses" id="arup_subbusiness" class="form-control input-form" name="arup_subbusiness" title="Input arup sub business" onfocusout="ensureSelected(this)" autocomplete="off" placeholder="Business sub-area" />
                            <datalist id="subbusinesses">
                            </datalist>
                        </div>
                        <div class="form-group col-lg-6">
                            <label for="arup_company">Arup Company:</label>
                            <input list="companies" id="arup_company" class="form-control input-form" name="arup_company" onchange="getAccountingCentres();" onfocusout="ensureSelected(this)"  title="Input Company" autocomplete="aoff" />
                            <datalist id="companies">
                            </datalist>
                        </div>
                        <div class="form-group col-lg-6">
                            <label for="accountingcentre">Accounting Centre:</label>
                            <input list="accountingcentres" id="accountingcentre" class="form-control input-form" name="accountingcentre" onfocusout="ensureSelected(this)"  title="Input Accounting Centre" autocomplete="off" />
                            <datalist id="accountingcentres">
                            </datalist>
                        </div>
                        <div class="form-group col-lg-6">
                            <label for="client">Client:</label>
                            <input list="clients" id="client" class="form-control input-form" name="client" oninput="getClients(this.value, true, this);" onfocusout="ensureSelected(this)"  onfocusout="ensureSelected(this)"  title="Input Client" autocomplete="off" placeholder="Client company name" />
                            <datalist id="clients">
                            </datalist>
                        </div>
                        <div class="form-group col-lg-6">
                            <label for="endclient">Ultimate/End Client:</label>
                            <input list="endclients" id="endclient" class="form-control input-form" name="endclient" oninput="getClients(this.value, false, this);" title="Input End Client" autocomplete="off" placeholder=" Ultimate client name" />
                            <datalist id="endclients">
                            </datalist>
                        </div>
                        <div class="form-group col-lg-6">
                            <label for="opporigin">Opportunity Originator:</label>
                            <input list="users" id="opporigin" class="form-control input-form" name="opporigin" onkeyup="getUsers(this.value);" title="Input Staff name" autocomplete="off" placeholder="Arup staff name" />
                            <datalist id="users">
                            </datalist>
                        </div>
                        <br />
                        <div class="form-group col-lg-12">
                            <label>Global Services:</label>
                            <p>
                                <label><input type="checkbox" name="global_services[]" value="100000001" /> Advisory Services</label>&nbsp;&nbsp;
                                <label><input type="checkbox" name="global_services[]" value="100000000" /> Architecture</label>&nbsp;&nbsp;
                                <label><input type="checkbox" name="global_services[]" value="100000006" /> Digital</label>&nbsp;&nbsp;
                                <label><input type="checkbox" name="global_services[]" value="100000002" /> Planning</label>&nbsp;&nbsp;
                                <label><input type="checkbox" name="global_services[]" value="770000000" /> Not Applicable</label>&nbsp;&nbsp;
                                <label><input type="checkbox" name="global_services[]" value="100000003" /> Other</label>
                            </p>
                        </div>
                        <div class="form-group col-lg-12">
                            <label for="description">Project Summary:</label>
                            <textarea id="description" class="form-control input-form" style="min-height: 72px; overflow: auto; height: auto;" maxlength="2000" role="textbox" attrname="description"></textarea>
                        </div>
                    </div>
                    <br><br>
                </div>
            </form>
            <div class="wizard-buttons">
                <button type="button" class="btn btn-default win-close">Exit</button>
                <button type="button" class="btn btn-default wizard-button-back" style="display: none;" tabindex="-1">Back</button>
                <button type="button" class="btn btn-default wizard-button-next">Next</button>
                <button type="button" class="btn btn-primary wizard-button-finish" style="display: none;">Create</button>
                <button type="button" class="btn btn-primary wizard-button-confirm pull-right" style="display: none;">Confirm</button>
                <button type="button" class="btn btn-default wizard-button-cancel" style="display: none;">Cancel</button>
            </div>

        </div>
    </div>
</body>
</html >
