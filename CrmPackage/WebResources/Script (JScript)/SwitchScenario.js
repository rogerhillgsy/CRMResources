var Mscrm;!function(e){var t;!function(e){"use strict";var t=function(){function e(){}return e}();t.DialogWidth="300px",t.ChangeManagerDialogName="ChangeManager",t.ReassignDialogName="ReassignAllRecords",t.JoinTeamsDialogName="JoinTeams",t.ManageUserRolesDialogName="ManageSystemUserRoles",t.ManageTeamRolesDialogName="ManageTeamRoles",t.AddTeamMembersDialogName="AddMembers",t.RemoveTeamMembersDialogName="RemoveMembers",t.DialogOkId="ok_id",t.OwnerId="owner_id",t.OwnerType="owner_type",t.EntityId="entity_id",t.EntityName="entity_name",t.LastButtonClicked="last_button_clicked",t.SystemUserViewId="systemuserview_id",t.EntityRecords="entity_records",t.TargetEntities="target_entities",t.RowsData="rows_data",t.UserRolesMap="user_rolesmap",t.TeamRolesMap="team_rolesmap",t.ColumnsDefinition="columns_definition",t.TotalRecordsSelected="total_records_selected",t.SelectedRecords="selected_records",t.ParentId="parent_id",t.ChangeManagerControlId="changemanagercontrol_id",t.customLabel="custom_label",t.ErrorKey_GenericErrorOccurred="SMBAdvSettings_GenericErrorOccurred",e.DialogConstants=t}(t=e.AppCommon||(e.AppCommon={}))}(Mscrm||(Mscrm={}));var Mscrm;!function(e){var t;!function(t){"use strict";var n=function(){function n(){}return n.GetControlValue=function(e){var t=Xrm.Page.ui.controls.get(e);if(t){var n=t.getAttribute();if(n)return n.getValue()}},n.SetControlValue=function(e,t){var n=Xrm.Page.ui.controls.get(e);if(n){var r=n.getAttribute();r&&r.setValue(t)}},n.DisableControl=function(e){var t=Xrm.Page.ui.controls.get(e);t&&t.setDisabled(!0)},n.EnableControl=function(e){var t=Xrm.Page.ui.controls.get(e);t&&t.setDisabled(!1)},n.SetVisible=function(e,t){var n=Xrm.Page.ui.controls.get(e);n&&n.setVisible(t)},n.HandleServerError=function(e){if(n.isNullOrUndefined(e)||n.isNullOrUndefined(e.errorCode)||0==e.errorCode||!n.isNullOrUndefined(e.errorCode)&&!n.isNullOrUndefined(e.message)&&""==e.message)return void n.ShowLocalizedErrorByResourceKey(t.DialogConstants.ErrorKey_GenericErrorOccurred);console.error("Error : "+e.message);var r={message:e.message,errorCode:e.errorCode};Xrm.Navigation.openErrorDialog(r)},n.ShowGenericError=function(e){n.isNullOrUndefined(e)||console.error(e),n.ShowLocalizedErrorByResourceKey(t.DialogConstants.ErrorKey_GenericErrorOccurred)},n.getLocalizedString=function(e){var t="AppCommon/Localization/Languages/AppCommon",n=Xrm.Utility.getResourceString(t,e);return void 0!==n&&null!==n||(n=e),n},n.ShowLocalizedErrorByResourceKey=function(e){var t=n.getLocalizedString(e);console.error("Error : "+t),Xrm.Utility.alertDialog(t)},n.isNullOrUndefined=function(e){return null==e||void 0==e},n.getClientUrl=function(){return Xrm.Page.context.getClientUrl()},n.handleError=function(e){console.log(e.message),Xrm.Utility.alertDialog(e.message)},n.GetCurrentUserBusinessUnitData=function(){var e=Xrm.Page.context.getUserId();return e=e.replace(/[{}]/g,""),Xrm.WebApi.retrieveRecord("systemuser",e,"?$select=systemuserid&$expand=businessunitid($select=name,businessunitid)")},n.createActionFailedErrorDialog=function(t){e.AppCommon.DialogUtils.hideProgressIndicator();var n={message:t.message,errorCode:t.errorCode};Xrm.Navigation.openErrorDialog(n)},n.actionFailedCallback=function(t){e.AppCommon.DialogUtils.hideProgressIndicator(),n.HandleServerError(t)},n.getETC=function(e){switch(e){case"systemuser":return 8;case"team":return 9}throw new Error("Invalid entity: "+e)},n.hideProgressIndicator=function(){Xrm.Utility.closeProgressIndicator()},n.showProgressIndicator=function(e){null==e?Xrm.Utility.showProgressIndicator():Xrm.Utility.showProgressIndicator(e)},n.showGlobalNotification=function(e,t){Xrm.UI.addGlobalNotification(1,1,e,t,null)},n.showGlobalNotification_GenericError=function(){Xrm.UI.addGlobalNotification(1,2,n.getLocalizedString(t.DialogConstants.ErrorKey_GenericErrorOccurred),"",null)},n}();t.DialogUtils=n}(t=e.AppCommon||(e.AppCommon={}))}(Mscrm||(Mscrm={}));var Mscrm;!function(e){var t;!function(e){"use strict";var t=function(){function e(){}return e}();t.GetRoles='\n\t\t<fetch version="1.0" output-format="xml-platform" mapping="logical" distinct="true">\n\t\t<entity name= "role">\n\t\t<attribute name="name"/>\n\t\t<attribute name= "roleid"/>{0}</entity></fetch>',t.GetSystemUserRoles='\n\t\t<fetch version="1.0" output-format="xml-platform" mapping="logical" distinct="true">\n\t\t\t<entity name="systemuser">\n\t\t\t\t<attribute name="systemuserid"/>\n\t\t\t\t<link-entity name="systemuserroles" from="systemuserid" to="systemuserid" intersect="true" alias="systemuserroles">\n\t\t\t\t<attribute name= "roleid"/>\n\t\t\t\t{0}\n\t\t\t\t</link-entity>\n\t\t\t</entity>\n\t\t</fetch>',t.GetTeamRoles='\n\t\t<fetch version="1.0" output-format="xml-platform" mapping="logical" distinct="true">\n\t\t\t<entity name="team">\n\t\t\t\t<attribute name="teamid"/>\n\t\t\t\t<link-entity name="teamroles" from="teamid" to="teamid" intersect="true" alias="teamroles">\n\t\t\t\t<attribute name= "roleid"/>\n\t\t\t\t{0}\n\t\t\t\t</link-entity>\n\t\t\t</entity>\n\t\t</fetch>',t.AppModuleRolesLinkEntity='\n\t\t<link-entity name="appmoduleroles" from="roleid" to="roleid" visible="false">\n\t\t{0}</link-entity>',t.ANDFilter='<filter type="and">{0}</filter>',t.ORFilter='<filter type="or">{0}</filter>',t.InOperatorValue="<value>{0}</value>",t.AppIdCondition='<condition attribute="appmoduleid" operator= "eq" value= "{0}" alias="appmoduleroles"/>',t.SystemUserIdCondition='<condition attribute="systemuserid" operator="in">{0}</condition>',t.TeamIdCondition='<condition attribute="teamid" operator="in">{0}</condition>',t.FetchXmlQueryString="?fetchXml=",e.FetchXmls=t}(t=e.AppCommon||(e.AppCommon={}))}(Mscrm||(Mscrm={}));var Mscrm;!function(e){var t;!function(e){"use strict";var t=function(){function e(){}return Object.defineProperty(e,"SCENARIO_NOTE_LABEL_CONTROL_NAME",{get:function(){return"switchScenarioNote_label"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"SCENARIOSELECTOR_CONTROL_NAME",{get:function(){return"scenario_id"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"SCENARIO_NOTE_KEY",{get:function(){return"SWITCHSCENARIO_NOTE"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"MARKETING_DESCRIPTION_KEY",{get:function(){return"SWITCHSCENARIO_MARKETING"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"ALL_SCENARIOS_DESCRIPTION_KEY",{get:function(){return"SWITCHSCENARIO_ALL_SCENARIOS"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"SALES_DESCRIPTION_KEY",{get:function(){return"SWITCHSCENARIO_SALES"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"SERVICE_DESCRIPTION_KEY",{get:function(){return"SWITCHSCENARIO_SERVICE"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"SUCCESS_NOTIFICATION_DESCRIPTION_KEY",{get:function(){return"SWITCHSCENARIO_SUCCESS_NOTIFICATION"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"PROJECT_SERVICE_DESCRIPTION_KEY",{get:function(){return"SWITCHSCENARIO_PROJECT_SERVICE"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"FIELD_SERVICE_DESCRIPTION_KEY",{get:function(){return"SWITCHSCENARIO_FIELD_SERVICE"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"SALESREP_ROLE_TEMPLATE_ID",{get:function(){return"a4be89ff-7c35-4d69-9900-999c3f603e6f"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"SMB_SALES_ROLES",{get:function(){return["f8c3a948-c7af-e611-80c3-02155dc6fe07","dc738938-c7af-e611-80c3-02155dc6fe07"]},enumerable:!0,configurable:!0}),Object.defineProperty(e,"SMB_MARKETING_ROLES",{get:function(){return["7c54ac52-9d1b-e711-80e1-00155d982906","bf157a3a-cde8-e611-80d8-00155d4b205a","ce995e5a-cee8-e611-80d8-00155d4b205a","d1fd2176-cee8-e611-80d8-00155d4b205a","a31a2242-bf8f-e611-80d7-00155d4b201d","26fca5d6-c18f-e611-80d7-00155d4b201d","a2c58c7e-34ea-e611-80db-00155d984d01","9f9ba390-c5e3-e611-80da-00155d4b2334","6ad0b4c6-35ea-e611-80db-00155d984d01","bf8fd239-6668-e111-8ed9-00155d230e08","8f821f0c-b4c1-e111-8b13-00155d230e08","968f28ee-00c0-e211-a09b-00155d230e1c","7e4229e1-eec1-e111-8b13-00155d230e08"]},enumerable:!0,configurable:!0}),Object.defineProperty(e,"FS_ROLES",{get:function(){return["00bb53d6-da92-e111-9d8c-000c2959f9b8","d008bfde-da92-e111-9d8c-000c2959f9b8","dc08bfde-da92-e111-9d8c-000c2959f9b8","c4b99aff-89b6-e311-9b7e-00155da8fa1b"]},enumerable:!0,configurable:!0}),Object.defineProperty(e,"PS_ROLES",{get:function(){return["d33acc3c-52a0-e511-80e9-00155db96303","65b5eb53-2ea3-e411-80d5-00155db98105","a4d4a4ed-e6a7-e411-80d9-00155db98105","09b5c4ee-c1ac-e411-80da-00155db98105","4d5c0a89-55b1-e411-80de-00155db98106","1bf7af34-c0d8-e411-80e7-fc15b4282bc4"]},enumerable:!0,configurable:!0}),Object.defineProperty(e,"APP_ACCESS_SALES_ROLE",{get:function(){return"cad52a75-568c-e611-80d4-00155d42a122"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"APP_ACCESS_CUSTOMER_SERVICE_ROLE",{get:function(){return"3dac4d9e-568c-e611-80d4-00155d42a122"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"SERVICE_ROLE_TEMPLATES",{get:function(){return["ecfd0b44-5720-45e3-ae68-417ddb0fb654","1808b939-dd07-4ca7-aa99-ddd2734378f1"]},enumerable:!0,configurable:!0}),Object.defineProperty(e,"ADMINISTERING_CRM_ROLE_TEMPLATES",{get:function(){return["627090ff-40a3-4053-8790-584edc5be201","119f245c-3cc8-4b62-b31c-d1a046ced15d"]},enumerable:!0,configurable:!0}),Object.defineProperty(e,"FETCHXML_ROLES_BY_ID",{get:function(){return'\n\t\t\t\t<fetch version="1.0" output-format="xml-platform" mapping="logical" distinct="true">\n\t\t\t\t\t<entity name= "role">\n\t\t\t\t\t\t<attribute name="name"/>\n\t\t\t\t\t\t<attribute name= "roleid"/>\n\t\t\t\t\t\t<filter type="and">\n\t\t\t\t\t\t\t<condition attribute="roleid" operator="in">{0}</condition>\n\t\t\t\t\t\t</filter>\n\t\t\t\t\t</entity>\n\t\t\t\t</fetch>'},enumerable:!0,configurable:!0}),Object.defineProperty(e,"FETCHXML_ROLES_BY_TEMPLATE_ID",{get:function(){return'\n\t\t\t\t<fetch version="1.0" output-format="xml-platform" mapping="logical" distinct="true">\n\t\t\t\t\t<entity name= "role">\n\t\t\t\t\t\t<attribute name="name"/>\n\t\t\t\t\t\t<attribute name= "roleid"/>\n\t\t\t\t\t\t<filter type="and">\n\t\t\t\t\t\t\t<condition attribute="roletemplateid" operator="in">{0}</condition>\n\t\t\t\t\t\t</filter>\n\t\t\t\t\t</entity>\n\t\t\t\t</fetch>'},enumerable:!0,configurable:!0}),Object.defineProperty(e,"FETCHXML_ROLES_FOR_SYSTEMUSER",{get:function(){return'\n\t\t<fetch version="1.0" output-format="xml-platform" mapping="logical" distinct="true">\n\t\t\t<entity name="role">\n\t\t\t\t<attribute name= "roleid"/>\n\t\t\t\t<attribute name= "roletemplateid" alias="templateid"/>\n\t\t\t\t<link-entity name="systemuserroles" from="roleid" to="roleid" intersect="true" alias="systemuserroles">\n\t\t\t\t\t<filter type="and">\n\t\t\t\t\t\t<condition attribute="systemuserid" operator= "eq" value= "{0}" alias="systemuserIdroles"/>\n\t\t\t\t\t</filter>\n\t\t\t\t</link-entity>\n\t\t\t</entity>\n\t\t</fetch>'},enumerable:!0,configurable:!0}),Object.defineProperty(e,"ENTITY_NAME_ROLE",{get:function(){return"role"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"ENTITY_NAME_SYSTEMUSER",{get:function(){return"systemuser"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"SYSTEMUSER_ROLE_RELATIONSHIP",{get:function(){return"systemuserroles_association"},enumerable:!0,configurable:!0}),e}();e.SwitchScenarioConstants=t}(t=e.AppCommon||(e.AppCommon={}))}(Mscrm||(Mscrm={}));var SmbAppsTelemetryUtility;!function(e){"use strict";var t=function(){function e(){}return e}();e.TelemetryParameter=t;var n=function(){function e(){}return e}();e.TelemetryPayload=n;var r;!function(e){e[e.BASICSHELLMODE=0]="BASICSHELLMODE",e[e.ADVANCEDSHELLMODE=1]="ADVANCEDSHELLMODE",e[e.STANDALONE=2]="STANDALONE"}(r=e.Controls_ShellMode||(e.Controls_ShellMode={}));var o;!function(e){e[e.BASICSETUPSUMMARY=0]="BASICSETUPSUMMARY",e[e.APPWELCOME=1]="APPWELCOME",e[e.SETTINGSUMMARY=2]="SETTINGSUMMARY",e[e.BRANDINGANDTHEMING=3]="BRANDINGANDTHEMING",e[e.FISCALYEAR=4]="FISCALYEAR",e[e.EMAILTEMPLATE=5]="EMAILTEMPLATE",e[e.WORDANDEXCELTEMPLATE=6]="WORDANDEXCELTEMPLATE",e[e.DOCUMENTSTORAGE=7]="DOCUMENTSTORAGE",e[e.QUOTETOCASH=8]="QUOTETOCASH",e[e.APPLICATIONMANAGEMENT=9]="APPLICATIONMANAGEMENT",e[e.SAMPLEDATAMANAGEMENT=10]="SAMPLEDATAMANAGEMENT",e[e.DUPLICATEDETECTION=11]="DUPLICATEDETECTION",e[e.USERMANAGEMENT=12]="USERMANAGEMENT",e[e.TEAMMANAGEMENT=13]="TEAMMANAGEMENT",e[e.CLICKTOCALL=14]="CLICKTOCALL",e[e.PRODUCTCATALOG=15]="PRODUCTCATALOG",e[e.LEADANDCONTACT=16]="LEADANDCONTACT",e[e.IMPORTDATA=17]="IMPORTDATA",e[e.EXPORTDATA=18]="EXPORTDATA",e[e.FORMS=19]="FORMS",e[e.VIEWS=20]="VIEWS",e[e.BUSINESSPROCESSFLOW=21]="BUSINESSPROCESSFLOW",e[e.SETWORKHOUR=22]="SETWORKHOUR"}(o=e.Controls_PageType||(e.Controls_PageType={}));var i;!function(e){e[e.CLICKEDBUTTON=0]="CLICKEDBUTTON",e[e.CLICKEDLINK=1]="CLICKEDLINK",e[e.CLICKEDCOMBOBOX=2]="CLICKEDCOMBOBOX",e[e.CLICKEDCHECKBOX=3]="CLICKEDCHECKBOX",e[e.CHANGEDTEXTBOX=4]="CHANGEDTEXTBOX",e[e.PAGEVISITED=5]="PAGEVISITED",e[e.ERROR=6]="ERROR",e[e.SUCCESS=7]="SUCCESS",e[e.COMPLETED=8]="COMPLETED",e[e.DROPPED=9]="DROPPED",e[e.UPLOADS=10]="UPLOADS",e[e.CLICKEDGRIDCOMMAND=11]="CLICKEDGRIDCOMMAND",e[e.CLICKEDFORMCOMMAND=12]="CLICKEDFORMCOMMAND",e[e.CLOSEDCOMMAND=13]="CLOSEDCOMMAND",e[e.CLICKEDSELECTBOX=14]="CLICKEDSELECTBOX"}(i=e.Controls_EventName||(e.Controls_EventName={}));var a=function(){function e(e,t,n,r,o,i,a,c,l){this._enableLogging=!0,this._context=e,this._count=t,this._pagetype=n,this._eventname=r,this._customcontrolname=o,this._customcontrolid=i,this._customcontrolShellmode=a,this._information=c,this._isError=l}return e.prototype._getMessageString=function(){var e;return e=this._isError?"CC_Name:"+this._customcontrolname+",CC_ID:"+this._customcontrolid+",CC_ShellMode:"+this._getShellMode(this._customcontrolShellmode)+",ErrorType:"+this._information:"CC_Name:"+this._customcontrolname+",CC_ID:"+this._customcontrolid+",CC_ShellMode:"+this._getShellMode(this._customcontrolShellmode)+",Message:"+this._information},e.prototype._getsolutionVersion=function(){var e="default";return window&&window.top&&window.top.getGlobalContextObject()&&window.top.getGlobalContextObject().getCurrentAppName()._result&&(e=window.top.getGlobalContextObject().getCurrentAppName()._result),e},e.prototype._getPageType=function(e){switch(e){case o.BASICSETUPSUMMARY:return"Basic Setup Summary Page";case o.APPLICATIONMANAGEMENT:return"Application Management Page";case o.APPWELCOME:return"App Welcome Page";case o.BRANDINGANDTHEMING:return"Branding and Theming Page";case o.DOCUMENTSTORAGE:return"Document Storage Page";case o.EMAILTEMPLATE:return"Email Template Page";case o.FISCALYEAR:return"Fiscal Year Page";case o.QUOTETOCASH:return"QuoteToCash Page";case o.SAMPLEDATAMANAGEMENT:return"Sample Data Management Page";case o.SETTINGSUMMARY:return"Setting Summary Page";case o.WORDANDEXCELTEMPLATE:return"Word And Excel Document Page";case o.DUPLICATEDETECTION:return"Duplicate Detection Page";case o.USERMANAGEMENT:return"User Management page";case o.TEAMMANAGEMENT:return"Team Management page";case o.CLICKTOCALL:return"Click To Call Page";case o.PRODUCTCATALOG:return"Product Catalog Page";case o.LEADANDCONTACT:return"Leads and Contacts Page";case o.IMPORTDATA:return"Import Data Page";case o.EXPORTDATA:return"Export Data Page";case o.FORMS:return"Forms Page";case o.VIEWS:return"Views Page";case o.BUSINESSPROCESSFLOW:return"Business process flow Page";default:return null}},e.prototype._getShellMode=function(e){switch(e){case r.ADVANCEDSHELLMODE:return"Advanced Shell";case r.BASICSHELLMODE:return"Basic Shell";case r.STANDALONE:return"StandAlone Page";default:return null}},e.prototype._getEventName=function(e){switch(e){case i.CHANGEDTEXTBOX:return"Changed TextBox";case i.CLICKEDBUTTON:return"Clicked Button";case i.CLICKEDCHECKBOX:return"Clicked CheckBox";case i.CLICKEDCOMBOBOX:return"Clicked ComboBox";case i.CLICKEDSELECTBOX:return"Clicked SelectBox";case i.CLICKEDLINK:return"Clicked Link";case i.COMPLETED:return"Activity Completed";case i.DROPPED:return"Activity Dropped";case i.ERROR:return"Error Encountered";case i.PAGEVISITED:return"Page Visited";case i.SUCCESS:return"Success";case i.UPLOADS:return"Uploads";case i.CLICKEDGRIDCOMMAND:return"Clicked Grid Command";default:return null}},e.prototype._getTelemetryData=function(){var e={eventName:"SMBFREEventInfo",eventParameters:[]},t={name:"ActionName",value:this._getEventName(this._eventname)},n={name:"Count",value:this._count},r={name:"Message",value:this._getMessageString()},o={name:"PageName",value:this._getPageType(this._pagetype)},i={name:"SolutionVersion",value:this._getsolutionVersion()};return e.eventParameters.push(t),e.eventParameters.push(n),e.eventParameters.push(r),e.eventParameters.push(o),e.eventParameters.push(i),e},e.ReportEventData=function(t,n,r,o,i,a,c,l,s){var u=new e(t,n,r,o,i,a,c,l,s);try{u._enableLogging&&(null!=u._context?u._context.reporting.reportEvent(u._getTelemetryData()):Xrm.Reporting.reportEvent(u._getTelemetryData()))}catch(d){console.log(d)}},e.ReportAppComponentFailureTelemetry=function(t,n,r,o){var i=new e(t,null,n),a={message:""},c="";"object"!=typeof r||null==r.message?a.message=JSON.stringify(r):a=r,i._pagetype&&(c=i._getsolutionVersion()+"."+i._getPageType(i._pagetype));try{null!=i._context?i._context.reporting.reportFailure(c,a,o):Xrm.Reporting.reportFailure(c,a,o)}catch(l){console.log(l)}},e}();e.TelemetryData=a}(SmbAppsTelemetryUtility||(SmbAppsTelemetryUtility={}));var Mscrm;!function(e){var t;!function(e){var t;!function(e){"use strict";var t;!function(e){e[e.None=0]="None",e[e.Excel=1]="Excel",e[e.Word=2]="Word"}(t=e.DocumentTemplateType||(e.DocumentTemplateType={}));var n=function(){function e(){}return e.isNull=function(e){return null===e},e.isNullOrUndefined=function(e){return null===e||void 0===e},e.isNullOrEmptyString=function(t){return e.isNullOrUndefined(t)||""===t},e.toStringWithNullCheck=function(t){return e.isNullOrUndefined(t)?t:t.toString()},e.newGuid=function(){return"xxxxxxxx-xxxx-xxxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0,n="x"==e?t:3&t|8;return n.toString(16)})},e.Base64ToBlob=function(e,t){if(this.isNullOrEmptyString(e))throw new Error("file Content cannot be empty");if(this.isNullOrEmptyString(t))throw new Error("file Type cannot be empty");for(var n=window.atob(e),r=n.length,o=new ArrayBuffer(r),i=new Uint8Array(o),a=0;r>a;a++)i[a]=n.charCodeAt(a);return new Blob([o],{type:t})},e.clickOnTempAnchor=function(e,t){var n=document.createElement("a");n.setAttribute("href",e),n.setAttribute("target","_blank"),n.setAttribute("download",t),document.body.appendChild(n),n.click(),document.body.removeChild(n)},e.GetCurrentAppId=function(){if(window&&window.top&&window.top.location&&window.top.location.href)for(var e=window.top.location.href,t=e.indexOf("?"),n=e.substring(t+1,e.length),r=n.split("&"),o=0;o<r.length;o++){var i=r[o].split("="),a=2===i.length?i[0]:null;if("appid"===a)return i[1]}return""},e.GetParkingSolutionIdFetchXML=function(e,t){var n="?fetchXml="+encodeURI('<fetch version="1.0" mapping="logical" distinct="true">\n\t\t\t\t\t <entity name="appconfiginstance">\n\t\t\t\t\t <attribute name="value" />\n\t\t\t\t\t <link-entity name="appconfig" to="appconfigid" from="appconfigid" link-type="inner" >\n\t\t\t\t\t\t <filter type="and">\n\t\t\t\t\t\t\t <condition attribute="appmoduleid" operator="eq" value="'+e+'"/>\n\t\t\t\t\t\t </filter >\n\t\t\t\t\t </link-entity>\n\t\t\t\t\t <link-entity name="solution" to="value" from="solutionid" link-type="inner"  />\n\t\t\t\t\t <filter type="and">\n\t\t\t\t\t\t<condition attribute="appconfigmasterid" operator="eq" value="'+t+'"/> </filter>\n\t\t\t\t\t </entity>\n\t\t\t\t </fetch>');return n},e.GetCurrentShellMode=function(){if(window&&window.top&&window.top.location&&window.top.location.href)for(var e=window.top.location.href,t=e.indexOf("?"),n=e.substring(t+1,e.length),r=n.split("&"),o=0;o<r.length;o++){var i=r[o].split("="),a=2===i.length?i[0]:null;if("appshellmode"===a)return i[1].toLowerCase()}return""},e.GetFileExtension=function(e){return this.isNullOrEmptyString(e)?e:e.substr(e.lastIndexOf(".")+1)},e.GetFileNameWithoutExtension=function(e){return this.isNullOrEmptyString(e)?e:e.substr(0,e.lastIndexOf("."))},e.GetDocumentTemplateType=function(e){switch(e){case"xlsx":return t.Excel;case"docx":return t.Word}return t.None},e.GetFileExtensionForDocument=function(e){switch(e){case t.Excel:return"xlsx";case t.Word:return"docx"}return""},e.EqualsIgnoreCase=function(e,t){var n=null==e,r=null==t,o=void 0==e,i=void 0==t;return!!(n&&r||o&&i)||n==r&&o==i&&e.toUpperCase()===t.toUpperCase()},e.isNullUndefinedOrWhitespace=function(e){return null==e||void 0==e||0===e.trim().length},e.GetCrmHostName=function(e){var t=e,n=t.indexOf(".");if(-1!=n){t=t.substring(n+1);var r=t.lastIndexOf("/");-1!=r&&(t=t.substring(0,r))}return t},e.IsSafari=function(){var e=window.navigator.userAgent.toLowerCase();return-1!=e.indexOf("safari")&&-1==e.indexOf("chrome")},e.IsIosDevice=function(){var e=window.navigator.userAgent.toLowerCase();return-1!=e.indexOf("iphone")||-1!=e.indexOf("ipad")},e.IsAndroidDevice=function(){var e=window.navigator.userAgent.toLowerCase();return-1!=e.indexOf("android")},e.DownloadFile=function(e,t,n){var r={fileContent:t,fileName:e,mimeType:n},o={openMode:2};window.Xrm.Navigation.openFile(r,o)},e.actionFailedErrorDialog=function(e){Xrm.Navigation.openErrorDialog({errorCode:e.errorCode,message:e.message})},e.generateExportFileName=function(e,t){var n=2===t?".docx":".xlsx";if("undefined"!=typeof Xrm.Utility.getGlobalContext()&&null!=Xrm.Utility.getGlobalContext()&&"undefined"!=typeof Xrm.Utility.getGlobalContext().userSettings&&null!=Xrm.Utility.getGlobalContext().userSettings&&e&&0!=e.length){var r=new Date,o=Xrm.Utility.getGlobalContext().userSettings.dateFormattingInfo.ShortDatePattern,i=Xrm.Utility.getGlobalContext().userSettings.dateFormattingInfo.LongTimePattern,a=Xrm.Utility.getGlobalContext().userSettings.dateFormattingInfo.DateSeparator,c=Xrm.Utility.getGlobalContext().userSettings.dateFormattingInfo.TimeSeparator,l=e+" "+r.format(o)+" "+r.format(i)+n;return l=l.split(a).join("-").split(c).join("-")}return e&&0!=e.length?""+e+n:"Export"+n},e.ParseXml=function(e){if(window.hasOwnProperty("DOMParser")){var t=new DOMParser;return t.parseFromString(e,"text/xml")}if(window.hasOwnProperty("ActiveXObject")){var n=new window.ActiveXObject("Microsoft.XMLDOM");return n.async=!1,n.loadXML(e),n}return null},e.getGridAttributes=function(){var e=["sortColumns","pageNum","recsPerPage","dataProvider","uiProvider","cols","max","refreshAsync","pagingCookie","enableMultiSort","enablePagingWhenOnePage","refreshCalledFromRefreshButton","totalrecordcount","allrecordscounted","returntotalrecordcount","getParameters","parameters","columns"];return e},e.getGridParameters=function(){var e=["autorefresh","isGridHidden","isGridFilteringEnabled","viewid","viewtype","RecordsPerPage","viewTitle","layoutXml","otc","otn","entitydisplayname","titleformat","entitypluraldisplayname","isWorkflowSupported","fetchXmlForFilters","isFetchXmlNotFinal","effectiveFetchXml","LayoutStyle","enableFilters","isTurboForm"];return e},e.getColumnValues=function(e){return""},e.getGridAttributesDefaultValues=function(){var t={};e.ParseXml(Xrm.Page.data.attributes.get("entity_fetchXml").getValue());return t.sortColumns="name:1",t.pageNum="1",t.recsPerPage="50",t.dataProvider="Microsoft.Crm.Application.Platform.Grid.GridDataProviderQueryBuilder",t.uiProvider="Microsoft.Crm.Application.Controls.GridUIProvider",t.Cols="Empty",t.max="-1",t.refreshAsync="false",t.pagingCookie="Empty",t.enableMultiSort="true",t.enablePagingWhenOnePage="true",t.refreshCalledFromRefreshButton="1",t.totalrecordcount=Xrm.Page.data.attributes.get("entity_totalRecordCount").getValue(),t.allrecordscounted="true",t.returntotalrecordcount="true",t.getParameters="Empty",t.columns=e.getColumnValues(Xrm.Page.data.attributes.get("entity_layoutXml").getValue()),t},e.getGridParameterDefaultValues=function(){var t={},n=Xrm.Page.data.attributes.get("entity_fetchXml").getValue(),r=Xrm.Page.data.attributes.get("entity_layoutXml").getValue(),o=Xrm.Page.data.attributes.get("entity_fetchXml").getValue(),i=Xrm.Page.data.attributes.get("entity_layoutXml").getValue();n=e.unescapeHtml(n),r=e.unescapeHtml(r),o=e.unescapeHtml(o),i=e.unescapeHtml(i);var a=Xrm.Page.data.attributes.get("entity_typeName").getValue();return t.autorefresh="1",t.isGridHidden="false",t.isGridFilteringEnabled="1",t.viewid=Xrm.Page.data.attributes.get("entity_viewId").getValue(),t.viewtype="1039",t.RecordsPerPage="50",t.viewTitle=encodeURIComponent(Xrm.Page.data.attributes.get("entity_viewName").getValue()),t.layoutXml=r,t.otc=Xrm.Page.data.attributes.get("entity_typeCode").getValue().toString(),t.otn=a,t.entitydisplayname=a,t.titleformat="{0} {1}",t.entitypluraldisplayname=a,t.isWorkflowSupported="true",t.fetchXmlForFilters=o,t.isFetchXmlNotFinal="False",t.effectiveFetchXml=o,t.LayoutStyle="GridList",t.enableFilters="1",t.isTurboForm="0",t.fetchXml=n,t},e.constructGridXml=function(){for(var t=e.getGridAttributes(),n="<grid></grid>",r=e.ParseXml(n),o=0,i=e.getGridAttributesDefaultValues(),a=e.getGridParameterDefaultValues(),c=e.getGridParameters();o<t.length;){var l=r.createElement(t[o]);"Empty"!=i[t[o]]&&(l.textContent=i[t[o]]),o++,r.documentElement.appendChild(l)}var s=r.querySelectorAll("grid>parameters"),u=s[0];for(o=0;o<t.length;){var d=r.createElement(c[o]);d.textContent=a[c[o]],o++,u.appendChild(d)}return(new XMLSerializer).serializeToString(r)},e.unescapeHtml=function(e){var t={amp:"&",lt:"<",le:"≤",gt:">",ge:"≥",quot:'"',"#039":"'"};return e.replace(/&([^;]+);/g,function(e,n){return t[n]||""})},e.constructPostData=function(){var t="",n=Xrm.Page.data.attributes.get("entity_exportType").getValue(),r=Xrm.Page.data.attributes.get("entity_fetchXml").getValue(),o=Xrm.Page.data.attributes.get("entity_layoutXml").getValue();return r=e.unescapeHtml(r),o=e.unescapeHtml(o),2==n?t=t.concat("exportType=dynamicXlsx&"):3==n&&(t=t.concat("exportType=pivotXlsx&")),t=t.concat("gridXml="+e.unescapeHtml(e.constructGridXml())+"&"),t=t.concat("fetchXml="+r+"&"),t=t.concat("layoutXml="+o+"&printAllPages=1")},e}();e.Utility=n}(t=e.Common||(e.Common={}))}(t=e.AppCommon||(e.AppCommon={}))}(Mscrm||(Mscrm={}));var ODataContract;!function(e){var t=function(){function e(e,t,n){this.target=e,this.relationship=t,this.relatedEntityId=n||null}return e.prototype.getMetadata=function(){return{boundParameter:"target",parameterTypes:{target:{typeName:"mscrm.crmbaseentity",structuralProperty:5},relationship:{typeName:"Edm.String",structuralProperty:1},relatedEntityId:{typeName:"Edm.String",structuralProperty:1}},operationName:"Disassociate",operationType:2}},e}();e.ODataDisassociateRequest=t}(ODataContract||(ODataContract={}));var ODataContract;!function(e){var t=function(){function e(e,t,n){this.target=e,this.relationship=t,this.relatedEntities=n}return e.prototype.getMetadata=function(){return{boundParameter:"target",parameterTypes:{target:{typeName:"mscrm.crmbaseentity",structuralProperty:5},relationship:{typeName:"Edm.String",structuralProperty:1},relatedEntities:{typeName:"mscrm.crmbaseentity",structuralProperty:4}},operationName:"Associate",operationType:2}},e}();e.ODataAssociateRequest=t}(ODataContract||(ODataContract={}));var Mscrm;!function(e){var t;!function(e){"use strict";var t;!function(e){e[e.Sales=0]="Sales",e[e.Service=1]="Service",e[e.All=2]="All",e[e.FieldService=3]="FieldService",e[e.ProjectService=4]="ProjectService",e[e.SMBSales=5]="SMBSales",e[e.SMBMarketing=6]="SMBMarketing"}(t=e.ScenarioCode||(e.ScenarioCode={}));var n=ODataContract.ODataAssociateRequest,r=ODataContract.ODataDisassociateRequest,o=function(){function o(){}return o.prototype.OnLoadHandler=function(t){try{e.SwitchScenarioCommand.InitializeScenarioData(t)}catch(n){e.DialogUtils.ShowGenericError(n)}},o.prototype.InitializeScenarioData=function(t){var n="";n=e.DialogUtils.getLocalizedString(e.SwitchScenarioConstants.SCENARIO_NOTE_KEY),t.getFormContext().getControl(e.SwitchScenarioConstants.SCENARIO_NOTE_LABEL_CONTROL_NAME).setLabel(n);Xrm.Page.context.getUserId();e.SwitchScenarioCommand.PopulateScenarioOptions()},o.prototype.PopulateScenarioOptions=function(){o.currentScenarioCode=t.All;var n=Xrm.Page.ui.controls.getByName(e.SwitchScenarioConstants.SCENARIOSELECTOR_CONTROL_NAME);e.SwitchScenarioCommand.CheckIfAnyRoleExists(e.SwitchScenarioConstants.SMB_MARKETING_ROLES.concat(e.SwitchScenarioConstants.SMB_SALES_ROLES)).then(function(r){r?(e.SwitchScenarioCommand.AddOption(n,t.All,e.SwitchScenarioConstants.ALL_SCENARIOS_DESCRIPTION_KEY),e.SwitchScenarioCommand.AddOption(n,t.SMBSales,e.SwitchScenarioConstants.SALES_DESCRIPTION_KEY),e.SwitchScenarioCommand.AddOption(n,t.SMBMarketing,e.SwitchScenarioConstants.MARKETING_DESCRIPTION_KEY)):(e.SwitchScenarioCommand.AddOption(n,t.All,e.SwitchScenarioConstants.ALL_SCENARIOS_DESCRIPTION_KEY),e.SwitchScenarioCommand.AddOption(n,t.Sales,e.SwitchScenarioConstants.SALES_DESCRIPTION_KEY),e.SwitchScenarioCommand.AddOption(n,t.Service,e.SwitchScenarioConstants.SERVICE_DESCRIPTION_KEY),e.SwitchScenarioCommand.CheckIfAnyRoleExists(e.SwitchScenarioConstants.PS_ROLES).then(function(r){r&&e.SwitchScenarioCommand.AddOption(n,t.ProjectService,e.SwitchScenarioConstants.PROJECT_SERVICE_DESCRIPTION_KEY)},e.DialogUtils.actionFailedCallback),e.SwitchScenarioCommand.CheckIfAnyRoleExists(e.SwitchScenarioConstants.FS_ROLES).then(function(r){r&&e.SwitchScenarioCommand.AddOption(n,t.FieldService,e.SwitchScenarioConstants.FIELD_SERVICE_DESCRIPTION_KEY)},e.DialogUtils.HandleServerError)),e.SwitchScenarioCommand.GetCurrentUserScenario().then(function(t){o.currentScenarioCode=t,e.DialogUtils.SetControlValue(e.SwitchScenarioConstants.SCENARIOSELECTOR_CONTROL_NAME,Number(t))},e.DialogUtils.HandleServerError)},e.DialogUtils.HandleServerError)},o.prototype.AddOption=function(t,n,r){var o;o={},o.value=Number(n);var i;i=e.DialogUtils.getLocalizedString(r),o.text=i,o.label=i,t.addOption(o)},o.prototype.BuildRoleIdsConditionXML=function(t){var n="";return t.forEach(function(t){n+=String.format(e.FetchXmls.InOperatorValue,t)}),n},o.prototype.CheckIfAnyRoleExists=function(t){return e.SwitchScenarioCommand.GetRolesById(t).then(function(t){return!(e.Common.Utility.isNullOrUndefined(t)||e.Common.Utility.isNullOrUndefined(t.entities)||t.entities.length<1)})},o.prototype.GetRolesById=function(t){var n=e.SwitchScenarioCommand.BuildRoleIdsConditionXML(t),r=String.format(e.SwitchScenarioConstants.FETCHXML_ROLES_BY_ID,n),o=Xrm.WebApi.retrieveMultipleRecords(e.SwitchScenarioConstants.ENTITY_NAME_ROLE,e.FetchXmls.FetchXmlQueryString+r);return o},o.prototype.GetRolesByTemplateId=function(t){var n=e.SwitchScenarioCommand.BuildRoleIdsConditionXML(t),r=String.format(e.SwitchScenarioConstants.FETCHXML_ROLES_BY_TEMPLATE_ID,n),o=Xrm.WebApi.retrieveMultipleRecords(e.SwitchScenarioConstants.ENTITY_NAME_ROLE,e.FetchXmls.FetchXmlQueryString+r);return o},o.prototype.GetRolesBySystemUser=function(t){var n=String.format(e.SwitchScenarioConstants.FETCHXML_ROLES_FOR_SYSTEMUSER,t),r=Xrm.WebApi.retrieveMultipleRecords(e.SwitchScenarioConstants.ENTITY_NAME_ROLE,e.FetchXmls.FetchXmlQueryString+n);return r},o.prototype.GetCurrentUserScenario=function(){var n=Xrm.Page.context.getUserId();return e.SwitchScenarioCommand.GetRolesBySystemUser(n).then(function(n){var r=t.All;n.entities.forEach(function(n){e.SwitchScenarioConstants.SMB_SALES_ROLES.indexOf(n.roleid)>-1&&(r=t.SMBSales),e.SwitchScenarioConstants.SMB_MARKETING_ROLES.indexOf(n.roleid)>-1&&(r=t.SMBMarketing),e.SwitchScenarioConstants.FS_ROLES.indexOf(n.roleid)>-1&&(r=t.FieldService),e.SwitchScenarioConstants.PS_ROLES.indexOf(n.roleid)>-1&&(r=t.ProjectService)});var o=!1;return n.entities.forEach(function(n){e.SwitchScenarioConstants.SALESREP_ROLE_TEMPLATE_ID.indexOf(n.templateid)>-1&&!o&&(r=t.Sales),e.SwitchScenarioConstants.SERVICE_ROLE_TEMPLATES.indexOf(n.templateid)>-1&&!o&&(r=t.Service),
e.SwitchScenarioConstants.ADMINISTERING_CRM_ROLE_TEMPLATES.indexOf(n.templateid)>-1&&(o=!0,r=t.All)}),r})},o.prototype.CloseButtonClickHandler=function(){try{Xrm.Page.ui.close()}catch(t){e.DialogUtils.ShowGenericError(t)}},o.prototype.DoneButtonClickHandler=function(){try{var t=e.DialogUtils.GetControlValue(e.SwitchScenarioConstants.SCENARIOSELECTOR_CONTROL_NAME),n=Number(t);if(n==o.currentScenarioCode)return void Xrm.Page.ui.close();e.SwitchScenarioCommand.UpdateRolesAndClose(n,o.currentScenarioCode)}catch(r){e.DialogUtils.ShowGenericError(r)}},o.prototype.GetExistingScenarioRoles=function(n){var r=[],o=[];switch(n){case t.SMBSales:r=e.SwitchScenarioConstants.SMB_SALES_ROLES;break;case t.SMBMarketing:r=e.SwitchScenarioConstants.SMB_MARKETING_ROLES;break;case t.ProjectService:r=e.SwitchScenarioConstants.PS_ROLES;break;case t.FieldService:r=e.SwitchScenarioConstants.FS_ROLES;break;case t.All:o=e.SwitchScenarioConstants.ADMINISTERING_CRM_ROLE_TEMPLATES;break;case t.Service:o=e.SwitchScenarioConstants.SERVICE_ROLE_TEMPLATES,r=[e.SwitchScenarioConstants.APP_ACCESS_CUSTOMER_SERVICE_ROLE];break;case t.Sales:o=[e.SwitchScenarioConstants.SALESREP_ROLE_TEMPLATE_ID],r=[e.SwitchScenarioConstants.APP_ACCESS_SALES_ROLE];break;default:console.log("Unexpected scenarioCode type: "+n)}var i=[];return r.length>0?e.SwitchScenarioCommand.GetRolesById(r).then(function(t){return t.entities.forEach(function(e){i.push(e.roleid)}),o.length>0?e.SwitchScenarioCommand.GetRolesByTemplateId(o).then(function(e){return e.entities.forEach(function(e){i.push(e.roleid)}),i}):i}):e.SwitchScenarioCommand.GetRolesByTemplateId(o).then(function(e){return e.entities.forEach(function(e){i.push(e.roleid)}),i})},o.prototype.UpdateRolesAndClose=function(t,o){var i=this;e.SwitchScenarioCommand.GetExistingScenarioRoles(t).then(function(t){var o=Xrm.Page.context.getUserId();e.SwitchScenarioCommand.GetRolesBySystemUser(o).then(function(a){var c=[],l=[],s=[],u=[];if(e.Common.Utility.isNullOrUndefined(a)||e.Common.Utility.isNullOrUndefined(a.entities))throw new Error("SwitchScenarioMDDAlert: Current user roles are missing.");a.entities.forEach(function(a){e.Common.Utility.isNullOrUndefined(a)||e.Common.Utility.isNullOrUndefined(a.roleid)||u.push(a.roleid);var d=i.minus(u,t),m=i.minus(t,u),S={id:String(o),name:"",entityType:e.SwitchScenarioConstants.ENTITY_NAME_SYSTEMUSER};for(var E in d){var C=d[E];c.push(new r(S,e.SwitchScenarioConstants.SYSTEMUSER_ROLE_RELATIONSHIP,String(C)))}for(var E in m){var C=m[E],f={id:String(C),name:"",entityType:e.SwitchScenarioConstants.ENTITY_NAME_ROLE},g=[f];l.push(new n(S,e.SwitchScenarioConstants.SYSTEMUSER_ROLE_RELATIONSHIP,g))}s=s.concat(l),s=s.concat(c),Xrm.WebApi.online.executeMultiple(s).then(function(t){t.every(function(e){return e.ok})?e.DialogUtils.showGlobalNotification(e.DialogUtils.getLocalizedString(e.SwitchScenarioConstants.SUCCESS_NOTIFICATION_DESCRIPTION_KEY)):e.DialogUtils.HandleServerError(t),Xrm.Page.ui.close()},e.DialogUtils.HandleServerError)},e.DialogUtils.HandleServerError)},e.DialogUtils.HandleServerError)},e.DialogUtils.HandleServerError)},o.prototype.minus=function(t,n){return e.DialogUtils.isNullOrUndefined(t)?[]:e.DialogUtils.isNullOrUndefined(n)?t:t.filter(function(e){return!(n.indexOf(e)>-1)})},o}();e.Scenario_SwitchScenario=o,e.SwitchScenarioCommand=new o}(t=e.AppCommon||(e.AppCommon={}))}(Mscrm||(Mscrm={}));
//# sourceMappingURL=G:\Agents\BA6584\_wap\15\s\target\retail\AnyCPU\AppCommonWebResources\MinifiedWebResources\ControlWS\SwitchScenario\SwitchScenario.js.map