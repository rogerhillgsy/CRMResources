<html>
<head>
    <title>Opportunity Wizard</title>
    ﻿

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1">


    <link rel="stylesheet" href="../arup_BootStrapCSS">
    <link rel="stylesheet" href="../arup_BootStrap_ThemeCSS">
    <link rel="stylesheet" href="../arup_Bootstrap_TableCSS">
    <link rel="stylesheet" href="../arup_Bootstrap_MultiselectCSS">
    <link rel="stylesheet" href="../arup_OppoWiz.css">
    <script type="text/javascript" src="../ccrm_/JavaScripts/Lib/jquery_3.2.0.min"></script>
    <script type="text/javascript" src="../arup_BootStrap.min"></script>
    <!--<script type="text/javascript" src="arup_Bootstrap_TableJS"></script>
    <script type="text/javascript" src="arup_Bootstrap_MultiselectJS"></script>-->
    <script type="text/javascript" src="arup_OppoWiz2.js"></script>
    <script type="text/javascript" src="../mag_/js/alert.js"></script>
    <script src="../ClientGlobalContext.js.aspx" type="text/javascript"></script>
    <!--<script src="arup_SDK.WebAPI_min.js" type="text/javascript"></script>-->
    <!--<script type="text/javascript" src="//cdn.jsdelivr.net/npm/@tarekraafat/ autocomplete.js@7.2.0/dist/js/autoComplete.min.js"></script>-->
    <!--<script type="text/javascript" src="arup_lib/autoComplete.js"></script>-->
    <script type="text/javascript" src="arup_oppoWizInput.js"></script>
</head>
<body style="overflow-wrap: break-word;">

<div class="container">
    <br><h1 class="mainPage"><b>New Opportunity Wizard</b></h1>
    <h4 class="mainPage1">Select opportunity category</h4>
</div>
<br>
<div class="container" width="100%" height="100%" id="mysub">
    <div class="wizard-content">
        <div class="wizard-steps-panel steps-quantity-4">
            <div class="step-number step-1 doing">
                <div class="number"><div class="img-circle"><img src="../arup_userrolejpg"></div></div>
            </div>
            <div class="step-number step-2">
                <div class="number">2</div>
            </div>
            <div class="step-number step-3">
                <div class="number">3</div>
            </div>
            <div class="step-number step-4">
                <div class="number">4</div>
            </div>
        </div>
        <!--<br /> -->
        <div class="container"> <br><br></div>
        <div id="wizard-steps"></div>
        <div class="wizard-step" style="display: block;" id="UR_Step">
            <div class="container" id="UR">
                <h2>Arup Internal </h2>
                <p><b><ins>Select whether the new opportunity is either Internal or External</ins></b></p>
                <form id="URForm">
                    <div class="radio">
                        <label><input type="radio" name="stepone" value="INT">&nbsp;Internal</label>
                    </div>
                    <div class="radio">
                        <label><input type="radio" name="stepone" value="NOTINT">&nbsp;External</label>
                    </div>
                </form>
            </div>
            <br><br>
        </div>
    </div>
</div>
<script type="text/javascript">
    $(document).ready(function() {
        //Initialize tooltips: TODO - needed?
        $(".win-close").click(function(e) {

            window.close();

        });

        wizard = new Arup.OpportunityWizard(
            {
                target: "mysub",
                exitText: 'exit',
                onfinish: function(e) {
                    //Validate form
                    var form = document.querySelector("form#page4");
                    Arup.validateOppWiz.validate(form).then(
                        function() {
                            saveOpportunity().then(
                                function(result) {
                                    Xrm.Utility.closeProgressIndicator();
                                    Xrm.Navigation.openAlertDialog({
                                        text: "Opportunity " + result.name + " has been created",
                                        title: "Opportunity " + result.newEntityid + " Created"
                                    });
                                },
                                function(errorDetail) { // Save failed
                                    Xrm.Utility.closeProgressIndicator();
                                    Xrm.Navigation.openErrorDialog(errorDetail);
                                });
                            Xrm.Utility.showProgressIndicator("Creating Opportunity");
                        },
                        function(errors) { // Validation failed
                            Xrm.Navigation.openErrorDialog({
                                message: "Invalid input - correct the form and try again",
                                // details: (typeof(errors) === "object") ? errors.join("\r\n") : errors,
                                title: "Validation errors"
                            });
                        }
                    );
                }
            });
    });
</script>
</body>
</html>